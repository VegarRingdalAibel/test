import { requestRender } from './requestRender';
import { getObservedAttributesMapSymbol, getObservedAttributesSymbol, getPropSymbol } from './symbols';
import { logger } from './logger';
export function attribute(options = {}) {
    return function reg(_class, prop) {
        Object.defineProperty(_class, prop, {
            get: function () {
                return this[getPropSymbol(this.tagName + '_' + prop)];
            },
            set: function (x) {
                logger('attribute set', this, this.tagName);
                const oldValue = this[getPropSymbol(this.tagName + '_' + prop)];
                this[getPropSymbol(this.tagName + '_' + prop)] = x;
                if (this.valuesChanged && oldValue !== x) {
                    this.valuesChanged('property', prop, oldValue, x);
                }
                if (oldValue !== x && !options.skipRender) {
                    requestRender(this);
                }
            },
            configurable: true
        });
        const attribute = prop
            .replace(/([a-z])([A-Z])/g, '$1-$2')
            .replace(/\s+/g, '-')
            .toLowerCase();
        if (!_class[getObservedAttributesMapSymbol()]) {
            _class[getObservedAttributesMapSymbol()] = new Map();
        }
        _class[getObservedAttributesMapSymbol()].set(attribute, prop);
        if (_class[getObservedAttributesSymbol()]) {
            _class[getObservedAttributesSymbol()].push(attribute);
        }
        else {
            _class[getObservedAttributesSymbol()] = [];
            _class[getObservedAttributesSymbol()].push(attribute);
        }
    };
}
//# sourceMappingURL=attribute.js.map